# building microservices

## 8. deployment
- one database per microservices
- environment always change
- principles:
    - isolation execution
    - automation
    - infra as a code
    - zero downtime deployment ( user or other services)
- lower cost, faster provisioning
- blue green deployment mechanism
- desired state management: kubernetes
- nomad: mirip kubernetes, tapi ga perlu container
- gitops: infras as code, chef and puppet
- deployment:
    - physical machine
    - VM
    - container
    - PAAS
    - FAAS
- VM:
    - think like a sockdrawer
    - what should we do, when we keep add partitioning?
    - type 2 virtualization: VM run on an OS
    - type 1 virtualization: VM run directly on hardware
    - autoscaling group in GCP and others
- Container:
    - LXC
    - container can have several OS, but using same kernel ![container](microservices_container.png)
    - virtual isolation
    - windows nano server
    - docker: image
    - kubernetes : managing lots of container accross lots of machine
- PAAS:
    - use a framework, they can provide lots ofr services for you
- FAAS:
    - serverless .. not means you dont use server, you are not managing one.
    - cuma memory yg bisa di mainin pakai FAAS.
- agregates:collection of item, treated like one

### kubernetes and container orchestration
- docker swarm, apache mesos, nomad
- parent: borg and omega
- how and when container platform are run
- kubernetes control plane, pod and node
- side car proxy, such as envoy
- pod : smallest deployable in kubernetes
- service : a stable routing endpoint
- the service to route call from and to the pod
- deploy pod that map to a service
- replica set ... desired state of the pod, ( how many, where to each etc)
- managing pod and replicaset -> deployment
- openShift, ada multitenancy
- katacoda has a good kubernetes tutorial
- CRD: common resource, extends core kubernetes API

### deployment
- feature toggle, canary release, parallel runs
- deployment -> install to environment, release -> make some part expose to user.
- Blue green deployment:
    - Blue is the live
    - Green is the new system
    - run in pararel
    - when green is ok, switch the request to green
- Canary release
    - small subset of user see the new feature
    - if all is ok, release for all
- Pararell run
    - two version at the same time
    - two request to compare
    - only use one of the result returned